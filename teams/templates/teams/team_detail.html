{% extends "teams/base.html" %}

{% block title %}{{ team.name }}{% endblock %}

{% block content %}


<div class="tabs">
    <button class="tab-button is-active" data-tab="events" type="button">Events</button>
    <button class="tab-button" data-tab="my-events" type="button">My booked events</button>
</div>

<div class="tab-panel is-active" id="events">
    {% if events %}
        <div class="event-list">
            {% for event in events %}
                <article class="event-card">
                    <div class="event-main">
                        <h3><a href="{% url 'teams:event-detail' event.id %}">{{ event.title }}</a></h3>
                        
                        <p>{{ event.starts_at|date:"l j F Y" }}<br>
                        {{ event.starts_at|date:"g:iA" }} - {{ event.ends_at|date:"g:iA" }}</p>
                        {% if event.location %}
                            <p>{{ event.location }}</p>
                        {% else %}
                            <p class="muted">No location set</p>
                        {% endif %}

                        <div class="event-stats">
                            <span>{{ event.spots_taken }}/{{ event.max_participants }} spots</span>
                            <span>£{{ event.price|floatformat:2 }}</span>
                        </div>
                    </div>
                    <div class="event-action">
                        <form method="post" action="{% url 'teams:event-signup' event.id %}">
                            {% csrf_token %}
                            {% if event.id in my_event_ids %}
                                <button class="button ghost" type="submit" name="signup" value="0">
                                    <i data-lucide="x"></i>
                                    Cancel
                                </button>
                            {% else %}
                                <button class="button" type="submit" name="signup" value="1" {% if event.is_full %}disabled{% endif %}>
                                    <i data-lucide="check"></i>
                                    Book
                                </button>
                                {% if event.is_full %}
                                    <span class="status">Event full</span>
                                {% endif %}
                            {% endif %}
                        </form>
                    </div>
                </article>
            {% endfor %}
        </div>
    {% else %}
        <div class="empty">
            <h2>No events yet</h2>
            <p>Admins can create events to get things moving.</p>
        </div>
    {% endif %}
</div>

<div class="tab-panel" id="my-events">
    {% if my_events %}
        <div class="event-list">
            {% for event in my_events %}
                <article class="event-card">
                    <div class="event-main">
                        <h3><a href="{% url 'teams:event-detail' event.id %}">{{ event.title }}</a></h3>
                        <div class="event-meta">
                            <span>{{ event.starts_at|date:"l j F Y" }}</span>
                            <span>{{ event.starts_at|date:"g:iA" }} - {{ event.ends_at|date:"g:iA" }}</span>
                            {% if event.location %}
                                <span>{{ event.location }}</span>
                            {% else %}
                                <span class="muted">No location set</span>
                            {% endif %}
                        </div>
                        <div class="event-stats">
                            <span>{{ event.spots_taken }}/{{ event.max_participants }} spots</span>
                            <span>Min {{ event.min_participants }}</span>
                            <span>£{{ event.price|floatformat:2 }}</span>
                        </div>
                    </div>
                    <div class="event-action">
                        <span class="status success">Booked</span>
                    </div>
                </article>
            {% endfor %}
        </div>
    {% else %}
        <div class="empty">
            <h2>No bookings yet</h2>
            <p>Check the events tab to claim a spot.</p>
        </div>
    {% endif %}
</div>

<script>
    const buttons = document.querySelectorAll(".tab-button");
    const panels = document.querySelectorAll(".tab-panel");

    const activate = (tabId) => {
        buttons.forEach((button) => {
            button.classList.toggle("is-active", button.dataset.tab === tabId);
        });
        panels.forEach((panel) => {
            panel.classList.toggle("is-active", panel.id === tabId);
        });
    };

    buttons.forEach((button) => {
        button.addEventListener("click", () => activate(button.dataset.tab));
    });

    if (window.location.hash) {
        const tabId = window.location.hash.replace("#", "");
        if (document.getElementById(tabId)) {
            activate(tabId);
        }
    }
</script>
{% endblock %}
