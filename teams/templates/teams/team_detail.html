{% extends "teams/base.html" %}

{% block title %}{{ team.name }}{% endblock %}

{% block content %}


<div class="tabs">
    <button class="tab-button is-active" data-tab="events" type="button">Events</button>
    <button class="tab-button" data-tab="my-events" type="button">My booked events</button>
</div>

<div class="tab-panel is-active" id="events">
    {% if events %}
        <div class="event-list">
            {% for event in events %}
                <article class="event-card">
                    <div class="event-main">
                        <h3><a href="{% url 'teams:event-detail' event.id %}">{{ event.title }}</a></h3>
                        
                        <div class="event-meta">
                            <span>{{ event.starts_at|date:"l j F Y" }}</span>
                            <span>{{ event.starts_at|date:"g:iA" }} - {{ event.ends_at|date:"g:iA" }}</span>
                            {% if event.venue %}
                                <span>{{ event.venue.name }}</span>
                            {% else %}
                                <span class="muted">No venue set</span>
                            {% endif %}
                        </div>

                        <div class="event-stats">
                            <span>{{ event.spots_taken }}/{{ event.max_participants }} spots</span>
                            <span>£{{ event.price|floatformat:2 }}</span>
                        </div>
                    </div>
                    <div class="event-action">
                        <form method="post" action="{% url 'teams:event-signup' event.id %}" class="status-form">
                            {% csrf_token %}
                            <div class="status-buttons">
                                <button
                                    class="button{% if event.my_status == 'yes' %} is-selected{% endif %}"
                                    type="submit"
                                    name="status"
                                    value="yes"
                                    {% if event.is_full and event.my_status != 'yes' %}disabled{% endif %}
                                >
                                    <i data-lucide="check"></i>
                                    Yes
                                </button>
                                <button
                                    class="button ghost status-maybe{% if event.my_status == 'maybe' %} is-selected{% endif %}"
                                    type="submit"
                                    name="status"
                                    value="maybe"
                                >
                                    <i data-lucide="help-circle"></i>
                                    Maybe
                                </button>
                                <button
                                    class="button ghost status-no{% if event.my_status == 'no' %} is-selected{% endif %}"
                                    type="submit"
                                    name="status"
                                    value="no"
                                >
                                    <i data-lucide="x"></i>
                                    No
                                </button>
                                {% if event.is_full or event.my_status == 'waitlist' %}
                                    <button
                                        class="button ghost{% if event.my_status == 'waitlist' %} is-selected{% endif %}"
                                        type="submit"
                                        name="status"
                                        value="waitlist"
                                    >
                                        <i data-lucide="clock"></i>
                                        Waitlist
                                    </button>
                                {% endif %}
                            </div>
                            {% if event.is_full and event.my_status != 'yes' %}
                                <span class="status">Event full</span>
                            {% endif %}
                        </form>
                    </div>
                </article>
            {% endfor %}
        </div>
    {% else %}
        <div class="empty">
            <h2>No events yet</h2>
            <p>Admins can create events to get things moving.</p>
        </div>
    {% endif %}
</div>

<div class="tab-panel" id="my-events">
    {% if my_events %}
        <div class="event-list">
            {% for event in my_events %}
                <article class="event-card">
                    <div class="event-main">
                        <h3><a href="{% url 'teams:event-detail' event.id %}">{{ event.title }}</a></h3>
                        <div class="event-meta">
                            <span>{{ event.starts_at|date:"l j F Y" }}</span>
                            <span>{{ event.starts_at|date:"g:iA" }} - {{ event.ends_at|date:"g:iA" }}</span>
                            {% if event.venue %}
                                <span>{{ event.venue.name }}</span>
                            {% else %}
                                <span class="muted">No venue set</span>
                            {% endif %}
                        </div>
                        <div class="event-stats">
                            <span>{{ event.spots_taken }}/{{ event.max_participants }} spots</span>
                            <span>Min {{ event.min_participants }}</span>
                            <span>£{{ event.price|floatformat:2 }}</span>
                        </div>
                    </div>
                    <div class="event-action">
                        <span class="status success">Booked</span>
                    </div>
                </article>
            {% endfor %}
        </div>
    {% else %}
        <div class="empty">
            <h2>No bookings yet</h2>
            <p>Check the events tab to claim a spot.</p>
        </div>
    {% endif %}
</div>

<script>
    const buttons = document.querySelectorAll(".tab-button");
    const panels = document.querySelectorAll(".tab-panel");

    const activate = (tabId) => {
        buttons.forEach((button) => {
            button.classList.toggle("is-active", button.dataset.tab === tabId);
        });
        panels.forEach((panel) => {
            panel.classList.toggle("is-active", panel.id === tabId);
        });
    };

    buttons.forEach((button) => {
        button.addEventListener("click", () => activate(button.dataset.tab));
    });

    if (window.location.hash) {
        const tabId = window.location.hash.replace("#", "");
        if (document.getElementById(tabId)) {
            activate(tabId);
        }
    }
</script>
{% endblock %}
