{% extends "teams/base.html" %}

{% block title %}{{ event.title }}{% endblock %}

{% block content %}
<section class="page-header">
    <div>
        <p class="kicker">Event</p>
        <h1>{{ event.title }}</h1>
        <div class="event-meta">
            <span>{{ event.starts_at|date:"l j F Y" }}</span>
            <span>{{ event.starts_at|date:"g:iA" }} - {{ event.ends_at|date:"g:iA" }}</span>
            {% if event.venue %}
                <span>{{ event.venue.name }}</span>
            {% else %}
                <span class="muted">No venue set</span>
            {% endif %}
        </div>
        <div class="event-stats">
            <span>{{ event.spots_taken }}/{{ event.max_participants }} spots</span>
            <span>Â£{{ event.price|floatformat:2 }}</span>
        </div>
    </div>
    <div class="header-actions">
        <form method="post" action="{% url 'teams:event-signup' event.id %}" class="status-form">
            {% csrf_token %}
            <div class="status-buttons">
                <button
                    class="button{% if my_status == 'yes' %} is-selected{% endif %}"
                    type="submit"
                    name="status"
                    value="yes"
                    {% if event.is_full and my_status != 'yes' %}disabled{% endif %}
                >
                    <i data-lucide="check"></i>
                    Yes
                </button>
                <button
                    class="button ghost status-maybe{% if my_status == 'maybe' %} is-selected{% endif %}"
                    type="submit"
                    name="status"
                    value="maybe"
                >
                    <i data-lucide="help-circle"></i>
                    Maybe
                </button>
                <button
                    class="button ghost status-no{% if my_status == 'no' %} is-selected{% endif %}"
                    type="submit"
                    name="status"
                    value="no"
                >
                    <i data-lucide="x"></i>
                    No
                </button>
                {% if event.is_full or my_status == 'waitlist' %}
                    <button
                        class="button ghost{% if my_status == 'waitlist' %} is-selected{% endif %}"
                        type="submit"
                        name="status"
                        value="waitlist"
                    >
                        <i data-lucide="clock"></i>
                        Waitlist
                    </button>
                {% endif %}
            </div>
            {% if event.is_full and my_status != 'yes' %}
                <span class="status">Event full</span>
            {% endif %}
        </form>
        <a class="button ghost" href="{% url 'teams:home' %}">Back to events</a>
    </div>
</section>

<div class="card-stack">
    <div class="card">
        <h2>Venue</h2>
        {% if event.venue %}
            <p><strong>{{ event.venue.name }}</strong></p>
            <p>
                {{ event.venue.address_line1 }}<br>
                {% if event.venue.address_line2 %}{{ event.venue.address_line2 }}<br>{% endif %}
                {% if event.venue.city %}{{ event.venue.city }}<br>{% endif %}
                {{ event.venue.postcode }}
            </p>
            {% if event.venue.url %}
                <p><a href="{{ event.venue.url }}" target="_blank" rel="noopener">Venue website</a></p>
            {% endif %}
            {% if event.venue.info %}
                <p class="muted">{{ event.venue.info }}</p>
            {% endif %}
        {% else %}
            <p class="muted">No venue set for this event.</p>
        {% endif %}
    </div>
    <div class="card">
        <h2>Players signed up ({{ signups_yes|length }})</h2>
        {% if signups_yes %}
            <ul class="player-list">
                {% for signup in signups_yes %}
                    <li>{{ signup.user.get_full_name|default:signup.user.username }}</li>
                {% endfor %}
            </ul>
        {% else %}
            <p class="muted">No one has booked yet.</p>
        {% endif %}
    </div>
    <div class="card">
        <h2>Waitlist ({{ signups_waitlist|length }})</h2>
        {% if signups_waitlist %}
            <ul class="player-list">
                {% for signup in signups_waitlist %}
                    <li>{{ signup.user.get_full_name|default:signup.user.username }}</li>
                {% endfor %}
            </ul>
        {% else %}
            <p class="muted">No one is waiting yet.</p>
        {% endif %}
    </div>
    <div class="card">
        <h2>Maybe ({{ signups_maybe|length }})</h2>
        {% if signups_maybe %}
            <ul class="player-list">
                {% for signup in signups_maybe %}
                    <li>{{ signup.user.get_full_name|default:signup.user.username }}</li>
                {% endfor %}
            </ul>
        {% else %}
            <p class="muted">No maybes yet.</p>
        {% endif %}
    </div>
    <div class="card">
        <h2>No ({{ signups_no|length }})</h2>
        {% if signups_no %}
            <ul class="player-list">
                {% for signup in signups_no %}
                    <li>{{ signup.user.get_full_name|default:signup.user.username }}</li>
                {% endfor %}
            </ul>
        {% else %}
            <p class="muted">No responses yet.</p>
        {% endif %}
    </div>
</div>
{% endblock %}
